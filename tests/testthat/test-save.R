path <- list.files(system.file("extdata/wc", package = "SMART"),
                   pattern = ".tif$", full.names = TRUE)

test_that("{shinytest2} recording: e2e_save", {
  app <- shinytest2::AppDriver$new(app_dir = '../../inst/shiny', name = "e2e_save")
  #app <- shinytest2::AppDriver$new(app_dir = 'inst/shiny', name = "e2e_save")
  app$set_inputs(tabs = "select")
  app$set_inputs(selectSel = "select_user")
  app$upload_file(`select_user-ras` = path)
  app$set_inputs(`select_user-name` = "bio")
  app$click("select_user-run")
  app$set_inputs(tabs = "plot")
  app$set_inputs(plotSel = "plot_hist")
  app$set_inputs(`plot_hist-pal` = "YlOrRd")
  app$click("plot_hist-run")
  app$set_inputs(main = "Table")
  app$expect_download("dl_table")
  #save_file <- app$get_download("dl_table")
  #app$expect_download("save_session")
  #print(save_file)
  #common <- app$get_value(export = "common")
  #expect_is(common$hist, 'histogram')
})

#testthat::snapshot_review('save/')

# app$set_window_size(width = 959, height = 653)
# # Update output value
# app$set_inputs(tabs = "select")
# app$set_inputs(map_bounds = c(76.6797849031069, 105.46875, -76.6797849031069, -105.1171875), allow_no_input_binding_ = TRUE)
# app$set_inputs(map_center = c(0, 0), allow_no_input_binding_ = TRUE)
# app$set_inputs(map_zoom = 2, allow_no_input_binding_ = TRUE)
# app$set_inputs(map_groups = "editableFeatureGroup", allow_no_input_binding_ = TRUE)
# app$set_inputs(selectSel = "select_user")
# # Uploaded file outside of: ./tests/testthat
# app$upload_file(`select_user-ras` = "bio05.tif")
# app$set_inputs(`select_user-name` = "nbh")
# app$click("select_user-run")
# app$set_inputs(map_groups = c("editableFeatureGroup", "nbh"), allow_no_input_binding_ = TRUE)
# app$set_inputs(map_bounds = c(11.092165893502, -56.07421875, -19.2281767377662, -82.3974609375), allow_no_input_binding_ = TRUE)
# app$set_inputs(map_center = c(-69.25, -4.20104138181628), allow_no_input_binding_ = TRUE)
# app$set_inputs(map_zoom = 5, allow_no_input_binding_ = TRUE)
# app$set_inputs(map_bounds = c(11.092165893502, -54.140625, -19.2281767377662, -84.3310546875), allow_no_input_binding_ = TRUE)
# app$set_inputs(map_center = c(-69.23583984375, -4.21494314139064), allow_no_input_binding_ = TRUE)
# app$set_inputs(map_bounds = c(11.092165893502, -53.5693359375, -19.2281767377662, -84.90234375), allow_no_input_binding_ = TRUE)
# app$set_inputs(map_bounds = c(11.092165893502, -47.373046875, -19.2281767377662, -91.0546875), allow_no_input_binding_ = TRUE)
# app$set_inputs(map_center = c(-69.2138671875, -4.21494314139064), allow_no_input_binding_ = TRUE)
# app$set_window_size(width = 1536, height = 1055)
# app$set_inputs(main = "Save")
# # Update output value
# app$expect_download("save_session")
# app$set_inputs(map_bounds = c(-4.21494314139064, -69.2138671875, -4.21494314139064, -69.2138671875), allow_no_input_binding_ = TRUE)
# app$set_window_size(width = 1536, height = 994)
# app$expect_download("save_session")
#
#shinytest2::record_test('inst/shiny')
